import questionStats from"../scripts/auth/question-stats.js";import api from"../scripts/api/index.js";import audio from"../audio/index.js";import CategoryManager from"../../quizbowl/category-manager.js";import{getDropdownValues}from"../scripts/utilities/dropdown-checklist.js";import{arrayToRange,createTossupCard,rangeToArray}from"../scripts/utilities/index.js";import CategoryModal from"../scripts/components/CategoryModal.min.js";import DifficultyDropdown from"../scripts/components/DifficultyDropdown.min.js";import upsertPlayerItem from"../scripts/upsertPlayerItem.js";const categoryManager=new CategoryManager;let oldCategories=JSON.stringify(categoryManager.export()),startingDifficulties=[],ownerId="",maxPacketNumber=24;/**
 * userId to player object
 */const players={},ROOM_NAME=decodeURIComponent(window.location.pathname.substring(13));let tossup={},USER_ID=window.localStorage.getItem("USER_ID")||"unknown",username=window.localStorage.getItem("multiplayer-username")||api.getRandomName();const socket=new window.WebSocket(window.location.href.replace("http","ws")+(window.location.href.endsWith("?private=true")?"&":"?")+new URLSearchParams({roomName:ROOM_NAME,userId:USER_ID,username}).toString()),PING_INTERVAL_ID=setInterval(()=>socket.send(JSON.stringify({type:"ping"})),45e3);// Ping server every 45 seconds to prevent socket disconnection
socket.onclose=function(a){const{code:b}=a;3e3!==b&&window.alert("Disconnected from server"),clearInterval(PING_INTERVAL_ID)},socket.onmessage=function(a){const b=JSON.parse(a.data);switch(b.type){case"enforcing-ban":return ackBannedFromRoom();case"buzz":return buzz(b);case"force-username":return forceUsername(b);case"chat":return chat(b,!1);case"chat-live-update":return chat(b,!0);case"clear-stats":return clearStats(b);case"connection-acknowledged":return connectionAcknowledged(b);case"connection-acknowledged-query":return connectionAcknowledgedQuery(b);case"connection-acknowledged-tossup":return connectionAcknowledgedTossup(b);case"end-of-set":return endOfSet(b);case"error":return handleError(b);case"give-answer":return giveAnswer(b);case"give-answer-live-update":return logGiveAnswer(b,!0);case"join":return join(b);case"leave":return leave(b);case"lost-buzzer-race":return lostBuzzerRace(b);case"next":return next(b);case"no-questions-found":return noQuestionsFound(b);case"owner-check":return ownerCheck(b);case"pause":return pause(b);case"reveal-answer":return revealAnswer(b);case"set-categories":return setCategories(b);case"set-difficulties":return setDifficulties(b);case"set-reading-speed":return setReadingSpeed(b);case"set-packet-numbers":return setPacketNumbers(b);case"set-strictness":return setStrictness(b);case"set-set-name":return setSetName(b);case"set-username":return setUsername(b);case"set-year-range":return setYearRange(b);case"skip":return next(b);case"start":return next(b);case"timer-update":return updateTimerDisplay(b.timeRemaining);case"toggle-lock":return toggleLock(b);case"toggle-login-required":return toggleLoginRequired(b);case"toggle-powermark-only":return togglePowermarkOnly(b);case"toggle-public":return togglePublic(b);case"toggle-rebuzz":return toggleRebuzz(b);case"toggle-select-by-set-name":return toggleSelectBySetName(b);case"toggle-skip":return toggleSkip(b);case"toggle-standard-only":return toggleStandardOnly(b);case"toggle-timer":return toggleTimer(b);case"update-question":return updateQuestion(b);case"verified-ban":return recvBan(b)}};function ackBannedFromRoom(){window.alert("You were banned from this room by the room owner, and cannot rejoin it."),setTimeout(()=>{window.location.replace("../")},100)}function recvBan({target:a,targetUsername:b}){a===USER_ID?(window.alert("You were banned from this room by the room owner."),setTimeout(()=>{window.location.replace("../")},100)):logEvent(b+" has been banned from this room.")}function buzz({userId:a,username:b}){logEvent(b,"buzzed"),document.getElementById("buzz").disabled=!0,document.getElementById("pause").disabled=!0,document.getElementById("next").disabled=!0,document.getElementById("skip").disabled=!0,a===USER_ID&&(document.getElementById("answer-input-group").classList.remove("d-none"),document.getElementById("answer-input").focus())}function chat({message:a,userId:c,username:d},e=!1){if(!e&&""===a)return void document.getElementById("live-chat-"+c).parentElement.remove();if(!e&&a)return document.getElementById("live-chat-"+c).className="",void(document.getElementById("live-chat-"+c).id="");if(document.getElementById("live-chat-"+c))return void(document.getElementById("live-chat-"+c).textContent=a);const f=document.createElement("b");f.textContent=d;const b=document.createElement("span");b.classList.add("text-muted"),b.id="live-chat-"+c,b.textContent=a;const g=document.createElement("li");g.appendChild(f),g.appendChild(document.createTextNode(" ")),g.appendChild(b),document.getElementById("room-history").prepend(g)}function clearStats({userId:a}){for(const b of["celerity","negs","points","powers","tens","tuh","zeroes"])players[a][b]=0;upsertPlayerItem(players[a],USER_ID,ownerId,socket),sortPlayerListGroup()}function connectionAcknowledged({buzzedIn:a,canBuzz:b,isPermanent:c,players:d,questionProgress:e,settings:f,userId:g}){document.getElementById("buzz").disabled=!b,c&&(document.getElementById("category-select-button").disabled=!0,document.getElementById("strictness").disabled=!0,document.getElementById("toggle-public").disabled=!0,document.getElementById("toggle-select-by-set-name").disabled=!0,document.getElementById("private-chat-warning").innerHTML="This is a permanent room. Some settings have been restricted."),processPlayers(d),sortPlayerListGroup();0===e?(document.getElementById("next").textContent="Start",document.getElementById("next").classList.remove("btn-primary"),document.getElementById("next").classList.add("btn-success")):1===e?(showSkipButton(),document.getElementById("settings").classList.add("d-none"),a?(document.getElementById("buzz").disabled=!0,document.getElementById("next").disabled=!0,document.getElementById("pause").disabled=!0):(document.getElementById("buzz").disabled=!1,document.getElementById("pause").disabled=!1)):2===e?(showNextButton(),document.getElementById("settings").classList.add("d-none")):void 0;document.getElementById("toggle-lock").checked=f.lock,document.getElementById("toggle-login-required").checked=f.loginRequired,document.getElementById("chat").disabled=f.public,document.getElementById("toggle-lock").disabled=f.public,document.getElementById("toggle-login-required").disabled=f.public,document.getElementById("toggle-timer").disabled=f.public,document.getElementById("toggle-public").checked=f.public,document.getElementById("reading-speed").value=f.readingSpeed,document.getElementById("reading-speed-display").textContent=f.readingSpeed,document.getElementById("strictness").value=f.strictness,document.getElementById("strictness-display").textContent=f.strictness,document.getElementById("toggle-rebuzz").checked=f.rebuzz,document.getElementById("toggle-skip").checked=f.skip,document.getElementById("timer").classList.toggle("d-none",!f.timer),document.getElementById("toggle-timer").checked=f.timer,USER_ID=g,window.localStorage.setItem("USER_ID",USER_ID)}async function processPlayers(a){const b=await get_owner_id();console.log("Await done"),await Promise.all(Object.keys(a).map(async c=>{a[c].celerity=a[c].celerity.correct.average,players[c]=a[c],upsertPlayerItem(players[c],USER_ID,b,socket)}))}async function connectionAcknowledgedQuery({difficulties:k=[],minYear:a,maxYear:b,packetNumbers:l=[],powermarkOnly:c,selectBySetName:d,setName:m="",standardOnly:e,alternateSubcategories:f,categories:g,subcategories:h,percentView:i,categoryPercents:j}){setDifficulties({difficulties:k}),$("#slider").slider("values",0,a),$("#slider").slider("values",1,b),document.getElementById("year-range-a").textContent=a,document.getElementById("year-range-b").textContent=b,document.getElementById("packet-number").value=arrayToRange(l),document.getElementById("toggle-powermark-only").checked=c,document.getElementById("difficulty-settings").classList.toggle("d-none",d),document.getElementById("set-settings").classList.toggle("d-none",!d),document.getElementById("toggle-select-by-set-name").checked=d,document.getElementById("toggle-powermark-only").disabled=d,document.getElementById("toggle-standard-only").disabled=d,document.getElementById("set-name").value=m,maxPacketNumber=await api.getNumPackets(m),""!==m&&0===maxPacketNumber&&document.getElementById("set-name").classList.add("is-invalid"),document.getElementById("toggle-standard-only").checked=e,categoryManager.import({categories:g,subcategories:h,alternateSubcategories:f,percentView:i,categoryPercents:j}),categoryManager.loadCategoryModal()}function connectionAcknowledgedTossup({tossup:a}){tossup=a,document.getElementById("set-name-info").textContent=tossup?.set?.name??"",document.getElementById("packet-number-info").textContent=tossup?.packet?.number??"-",document.getElementById("question-number-info").textContent=tossup?.number??"-"}function endOfSet(){window.alert("You have reached the end of the set")}function forceUsername({message:a,username:b}){window.alert(a),window.localStorage.setItem("multiplayer-username",b),document.querySelector("#username").value=b}async function giveAnswer({celerity:a,directive:b,directedPrompt:c,givenAnswer:d,perQuestionCelerity:e,score:f,tossup:g,userId:h,username:i}){document.getElementById("answer-input").value="",document.getElementById("answer-input-group").classList.add("d-none"),document.getElementById("answer-input").blur(),logGiveAnswer({directive:b,message:d,username:i}),"prompt"===b&&c?logEvent(i,`was prompted with "${c}"`):"prompt"===b?logEvent(i,"was prompted"):logEvent(i,`${0<f?"":"in"}correctly answered for ${f} points`),"prompt"===b&&h===USER_ID?(document.getElementById("answer-input-group").classList.remove("d-none"),document.getElementById("answer-input").focus(),document.getElementById("answer-input").placeholder=c?`Prompt: "${c}"`:"Prompt"):"prompt"!==b&&(document.getElementById("answer-input").placeholder="Enter answer",document.getElementById("next").disabled=!1,document.getElementById("pause").disabled=!1,"accept"===b&&(document.getElementById("buzz").disabled=!0,Array.from(document.getElementsByClassName("tuh")).forEach(a=>{a.textContent=parseInt(a.innerHTML)+1})),"reject"===b&&(document.getElementById("buzz").disabled=!document.getElementById("toggle-rebuzz").checked&&h===USER_ID),10<f?players[h].powers++:10===f?players[h].tens++:0>f&&players[h].negs++,players[h].points+=f,players[h].tuh++,players[h].celerity=a,upsertPlayerItem(players[h],USER_ID,ownerId,socket),sortPlayerListGroup()),"prompt"!==b&&h===USER_ID&&questionStats.recordTossup(g,0<f,f,e,!0),audio.soundEffects&&h===USER_ID&&("accept"===b&&10<f?audio.power.play():"accept"===b&&10===f?audio.correct.play():"reject"===b&&audio.incorrect.play())}function handleError({message:a}){socket.close(3e3),window.alert(a),window.location.href="/multiplayer"}function join({isNew:a,user:b,userId:c,username:d}){logEvent(d,"joined the game");c===USER_ID||(a?(b.celerity=b.celerity.correct.average,upsertPlayerItem(b,USER_ID,ownerId,socket),sortPlayerListGroup(),players[c]=b):(players[c].online=!0,document.getElementById("points-"+c).classList.add("bg-success"),document.getElementById("points-"+c).classList.remove("bg-secondary")))}function leave({userId:a,username:b}){logEvent(b,"left the game"),players[a].online=!1,document.getElementById("points-"+a).classList.remove("bg-success"),document.getElementById("points-"+a).classList.add("bg-secondary")}function logEvent(a,b){const c=document.createElement("span");c.textContent=a;const d=document.createElement("span");d.textContent=b;const e=document.createElement("i");e.appendChild(c),e.appendChild(document.createTextNode(" ")),e.appendChild(d);const f=document.createElement("li");f.appendChild(e),document.getElementById("room-history").prepend(f)}function logGiveAnswer({directive:d=null,message:a,username:c}){const e=document.createElement("span");switch(e.textContent="Buzz",d){case"accept":e.className="badge text-dark bg-success";break;case"reject":e.className="badge text-light bg-danger";break;case"prompt":e.className="badge text-dark bg-warning";break;default:e.className="badge text-light bg-primary"}const f=document.createElement("b");f.textContent=c;const b=document.createElement("span");b.textContent=a;let g;if(document.getElementById("live-buzz")?(g=document.getElementById("live-buzz"),g.textContent=""):(g=document.createElement("li"),g.id="live-buzz",document.getElementById("room-history").prepend(g)),g.appendChild(e),g.appendChild(document.createTextNode(" ")),g.appendChild(f),g.appendChild(document.createTextNode(" ")),g.appendChild(b),"accept"===d||"reject"===d){const a=document.createElement("span");a.className=e.className,"accept"===d?a.textContent="Correct":"reject"===d&&(a.textContent="Incorrect"),g.appendChild(document.createTextNode(" ")),g.appendChild(a)}d&&(g.id="")}function lostBuzzerRace({username:a,userId:b}){logEvent(a,"lost the buzzer race"),b===USER_ID&&document.getElementById("answer-input-group").classList.add("d-none")}function next({oldTossup:a,tossup:b,type:c,username:d}){switch(c){case"next":logEvent(d,"went to the next question");break;case"skip":logEvent(d,"skipped the question");break;case"start":logEvent(d,"started the game");break;default:throw new Error("Invalid type")}"next"===c||"skip"===c?createTossupCard(a):"start"===c&&(document.getElementById("next").classList.add("btn-primary"),document.getElementById("next").classList.remove("btn-success"),document.getElementById("next").textContent="Next"),tossup=b,document.getElementById("packet-number-info").textContent=tossup?.packet.number??"-",document.getElementById("question-number-info").textContent=tossup?.number??"-",document.getElementById("set-name-info").textContent=tossup?.set.name??"",document.getElementById("answer").textContent="",document.getElementById("question").textContent="",document.getElementById("buzz").textContent="Buzz",document.getElementById("buzz").disabled=!1,document.getElementById("pause").textContent="Pause",document.getElementById("pause").disabled=!1,document.getElementById("settings").classList.add("d-none"),showSkipButton(),updateTimerDisplay(100)}function noQuestionsFound(){window.alert("No questions found")}let resolveOwnerId;function ownerCheck({id:a}){ownerId=a,resolveOwnerId&&(resolveOwnerId(),resolveOwnerId=null)}function get_owner_id(){return new Promise(a=>{resolveOwnerId=a,socket.send(JSON.stringify({type:"owner-id"}))}).then(()=>ownerId)}function pause({paused:a,username:b}){logEvent(b,`${a?"":"un"}paused the game`)}function revealAnswer({answer:a,question:b}){document.getElementById("question").innerHTML=b,document.getElementById("answer").innerHTML="ANSWER: "+a,document.getElementById("pause").disabled=!0,showNextButton()}function showNextButton(){document.getElementById("next").classList.remove("d-none"),document.getElementById("next").disabled=!1,document.getElementById("skip").classList.add("d-none"),document.getElementById("skip").disabled=!0}function showSkipButton(){document.getElementById("skip").classList.remove("d-none"),document.getElementById("skip").disabled=!document.getElementById("toggle-skip").checked,document.getElementById("next").classList.add("d-none"),document.getElementById("next").disabled=!0}function sortPlayerListGroup(c=!0){const d=document.getElementById("player-list-group"),e=Array.from(d.children),f=11;e.sort((d,a)=>{const b=parseInt(document.getElementById("points-"+d.id.substring(f)).innerHTML),e=parseInt(document.getElementById("points-"+a.id.substring(f)).innerHTML);// if points are equal, sort alphabetically by username
if(b===e){const b=document.getElementById("username-"+d.id.substring(f)).innerHTML,e=document.getElementById("username-"+a.id.substring(f)).innerHTML;return c?b.localeCompare(e):e.localeCompare(b)}return c?e-b:b-e}).forEach(a=>{d.appendChild(a)})}function setCategories({alternateSubcategories:a,categories:b,subcategories:c,percentView:d,categoryPercents:e,username:f}){logEvent(f,"updated the categories"),categoryManager.import({categories:b,subcategories:c,alternateSubcategories:a,percentView:d,categoryPercents:e}),categoryManager.loadCategoryModal()}function setDifficulties({difficulties:a,username:b=void 0}){return b&&logEvent(b,0<a.length?`set the difficulties to ${a}`:"cleared the difficulties"),document.getElementById("difficulties")?void Array.from(document.getElementById("difficulties").children).forEach(b=>{const c=b.querySelector("input");a.includes(parseInt(c.value))?(c.checked=!0,b.classList.add("active")):(c.checked=!1,b.classList.remove("active"))}):void(startingDifficulties=a)}function setPacketNumbers({username:a,packetNumbers:b}){b=arrayToRange(b),logEvent(a,0<b.length?`changed packet numbers to ${b}`:"cleared packet numbers"),document.getElementById("packet-number").value=b}function setReadingSpeed({username:a,readingSpeed:b}){logEvent(a,`changed the reading speed to ${b}`),document.getElementById("reading-speed").value=b,document.getElementById("reading-speed-display").textContent=b}function setStrictness({strictness:a,username:b}){logEvent(b,`changed the strictness to ${a}`),document.getElementById("strictness").value=a,document.getElementById("strictness-display").textContent=a}function setSetName({username:a,setName:b}){logEvent(a,0<b.length?`changed set name to ${b}`:"cleared set name"),document.getElementById("set-name").value=b}function setUsername({oldUsername:a,newUsername:b,userId:c}){logEvent(a,`changed their username to ${b}`),document.getElementById("username-"+c).textContent=b,players[c].username=b,sortPlayerListGroup(),c===USER_ID&&(username=b,window.localStorage.setItem("multiplayer-username",username),document.getElementById("username").value=username),upsertPlayerItem(players[c],USER_ID,ownerId,socket)}function toggleLock({lock:a,username:b}){logEvent(b,`${a?"locked":"unlocked"} the room`),document.getElementById("toggle-lock").checked=a}function toggleLoginRequired({loginRequired:a,username:b}){logEvent(b,`${a?"enabled":"disabled"} require players to be logged in`),document.getElementById("toggle-login-required").checked=a}function togglePowermarkOnly({powermarkOnly:a,username:b}){logEvent(b,`${a?"enabled":"disabled"} powermark only`),document.getElementById("toggle-powermark-only").checked=a}function toggleRebuzz({rebuzz:a,username:b}){logEvent(b,`${a?"enabled":"disabled"} multiple buzzes (effective next question)`),document.getElementById("toggle-rebuzz").checked=a}function toggleSelectBySetName({selectBySetName:a,setName:b,username:c}){logEvent(c,"enabled select by "+(a?"set name":"difficulty")),document.getElementById("toggle-select-by-set-name").checked=a,document.getElementById("toggle-powermark-only").disabled=a,document.getElementById("toggle-standard-only").disabled=a,a?(document.getElementById("difficulty-settings").classList.add("d-none"),document.getElementById("set-settings").classList.remove("d-none"),document.getElementById("set-name").textContent=b):(document.getElementById("difficulty-settings").classList.remove("d-none"),document.getElementById("set-settings").classList.add("d-none"))}function toggleSkip({skip:a,username:b}){logEvent(b,`${a?"enabled":"disabled"} skipping`),document.getElementById("toggle-skip").checked=a,document.getElementById("skip").disabled=!a||document.getElementById("skip").classList.contains("d-none")}function toggleStandardOnly({standardOnly:a,username:b}){logEvent(b,`${a?"enabled":"disabled"} standard format only`),document.getElementById("toggle-standard-only").checked=a}function toggleTimer({timer:a,username:b}){logEvent(b,`${a?"enabled":"disabled"} the timer`),document.getElementById("toggle-timer").checked=a,document.getElementById("timer").classList.toggle("d-none")}function togglePublic({public:a,username:b}){logEvent(b,`made the room ${a?"public":"private"}`),document.getElementById("chat").disabled=a,document.getElementById("toggle-lock").disabled=a,document.getElementById("toggle-login-required").disabled=a,document.getElementById("toggle-timer").disabled=a,document.getElementById("toggle-timer").checked=!0,document.getElementById("toggle-public").checked=a,a&&(document.getElementById("toggle-lock").checked=!1,document.getElementById("toggle-login-required").checked=!1)}function updateQuestion({word:a}){"(*)"===a||(document.getElementById("question").innerHTML+=a+" ")}function updateTimerDisplay(a){const b=Math.floor(a/10);document.querySelector(".timer .face").innerText=b,document.querySelector(".timer .fraction").innerText="."+a%10}function setYearRange({minYear:a,maxYear:b,username:c}){c&&logEvent(c,`changed the year range to ${a}-${b}`),$("#slider").slider("values",0,a),$("#slider").slider("values",1,b),document.getElementById("year-range-a").textContent=a,document.getElementById("year-range-b").textContent=b}document.getElementById("answer-form").addEventListener("submit",function(a){a.preventDefault(),a.stopPropagation();const b=document.getElementById("answer-input").value;socket.send(JSON.stringify({type:"give-answer",givenAnswer:b}))}),document.getElementById("answer-input").addEventListener("input",function(){socket.send(JSON.stringify({type:"give-answer-live-update",message:this.value}))}),document.getElementById("buzz").addEventListener("click",function(){this.blur(),audio.soundEffects&&audio.buzz.play(),socket.send(JSON.stringify({type:"buzz"})),socket.send(JSON.stringify({type:"give-answer-live-update",message:""}))}),document.getElementById("chat").addEventListener("click",function(){this.blur(),document.getElementById("chat-input-group").classList.remove("d-none"),document.getElementById("chat-input").focus(),socket.send(JSON.stringify({type:"chat-live-update",message:""}))}),document.getElementById("chat-form").addEventListener("submit",function(a){a.preventDefault(),a.stopPropagation();const b=document.getElementById("chat-input").value;document.getElementById("chat-input").value="",document.getElementById("chat-input-group").classList.add("d-none"),document.getElementById("chat-input").blur(),socket.send(JSON.stringify({type:"chat",message:b}))}),document.getElementById("chat-input").addEventListener("input",function(){socket.send(JSON.stringify({type:"chat-live-update",message:this.value}))}),document.getElementById("clear-stats").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"clear-stats"}))}),document.getElementById("next").addEventListener("click",function(){switch(this.blur(),this.innerHTML){case"Start":socket.send(JSON.stringify({type:"start"}));break;case"Next":socket.send(JSON.stringify({type:"next"}))}}),document.getElementById("skip").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"skip"}))}),document.getElementById("packet-number").addEventListener("change",function(){const a=rangeToArray(this.value,maxPacketNumber);return a.some(a=>1>a||a>maxPacketNumber)?void document.getElementById("packet-number").classList.add("is-invalid"):void(document.getElementById("packet-number").classList.remove("is-invalid"),socket.send(JSON.stringify({type:"set-packet-numbers",packetNumbers:a})))}),document.getElementById("pause").addEventListener("click",function(){this.blur();const a=parseFloat(document.querySelector(".timer .face").innerText),b=parseFloat(document.querySelector(".timer .fraction").innerText);socket.send(JSON.stringify({type:"pause",pausedTime:10*(a+b)}))}),document.getElementById("reading-speed").addEventListener("change",function(){socket.send(JSON.stringify({type:"set-reading-speed",readingSpeed:this.value}))}),document.getElementById("reading-speed").addEventListener("input",function(){document.getElementById("reading-speed-display").textContent=this.value}),document.getElementById("report-question-submit").addEventListener("click",function(){api.reportQuestion(document.getElementById("report-question-id").value,document.getElementById("report-question-reason").value,document.getElementById("report-question-description").value)}),document.getElementById("set-name").addEventListener("change",async function(){api.getSetList().includes(this.value)||0===this.value.length?this.classList.remove("is-invalid"):this.classList.add("is-invalid"),maxPacketNumber=await api.getNumPackets(this.value),document.getElementById("packet-number").value=""===this.value||0===maxPacketNumber?"":`1-${maxPacketNumber}`,socket.send(JSON.stringify({type:"set-set-name",setName:this.value,packetNumbers:rangeToArray(document.getElementById("packet-number").value)}))}),document.getElementById("strictness").addEventListener("change",function(){this.blur(),socket.send(JSON.stringify({type:"set-strictness",strictness:this.value}))}),document.getElementById("strictness").addEventListener("input",function(){document.getElementById("strictness-display").textContent=this.value}),document.getElementById("toggle-lock").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-lock",lock:this.checked}))}),document.getElementById("toggle-login-required").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-login-required",loginRequired:this.checked}))}),document.getElementById("toggle-powermark-only").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-powermark-only",powermarkOnly:this.checked}))}),document.getElementById("toggle-rebuzz").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-rebuzz",rebuzz:this.checked}))}),document.getElementById("toggle-skip").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-skip",skip:this.checked}))}),document.getElementById("toggle-select-by-set-name").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-select-by-set-name",setName:document.getElementById("set-name").value,selectBySetName:this.checked}))}),document.getElementById("toggle-settings").addEventListener("click",function(){this.blur(),document.getElementById("buttons").classList.toggle("col-lg-9"),document.getElementById("buttons").classList.toggle("col-lg-12"),document.getElementById("content").classList.toggle("col-lg-9"),document.getElementById("content").classList.toggle("col-lg-12"),document.getElementById("settings").classList.toggle("d-none"),document.getElementById("settings").classList.toggle("d-lg-none")}),document.getElementById("toggle-standard-only").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-standard-only",standardOnly:this.checked}))}),document.getElementById("toggle-timer").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-timer",timer:this.checked}))}),document.getElementById("toggle-public").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-public",public:this.checked}))}),document.getElementById("username").addEventListener("change",function(){socket.send(JSON.stringify({type:"set-username",userId:USER_ID,username:this.value})),username=this.value,window.localStorage.setItem("multiplayer-username",username)}),document.getElementById("year-range-a").onchange=function(){const[a,b]=$("#slider").slider("values");if(b<a)return void(document.querySelector("#yearRangeAlert").style.display="");document.querySelector("#yearRangeAlert").style.display="none";socket.send(JSON.stringify({type:"set-year-range",minYear:a,maxYear:b}))},document.addEventListener("keydown",a=>{if("Escape"===a.key&&"chat-input"===document.activeElement.id&&(document.getElementById("chat-input").value="",document.getElementById("chat-input-group").classList.add("d-none"),document.getElementById("chat-input").blur(),socket.send(JSON.stringify({type:"chat",message:""}))),!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement.tagName))switch(a.key?.toLowerCase()){case" ":document.getElementById("buzz").click(),a.target===document.body&&a.preventDefault();break;case"e":return document.getElementById("toggle-settings").click();case"k":return document.getElementsByClassName("card-header-clickable")[0].click();case"p":return document.getElementById("pause").click();case"t":return document.getElementsByClassName("star-tossup")[0].click();case"y":return navigator.clipboard.writeText(tossup._id??"");case"n":case"s":document.getElementById("next").click(),document.getElementById("skip").click()}}),document.addEventListener("keypress",function(a){"Enter"===a.key&&a.target===document.body&&document.getElementById("chat").click()}),document.getElementById("username").value=username,ReactDOM.createRoot(document.getElementById("category-modal-root")).render(/*#__PURE__*/React.createElement(CategoryModal,{categoryManager:categoryManager,onClose:()=>{oldCategories!==JSON.stringify(categoryManager.export())&&socket.send(JSON.stringify({type:"set-categories",...categoryManager.export()})),oldCategories=JSON.stringify(categoryManager.export())}})),ReactDOM.createRoot(document.getElementById("difficulty-dropdown-root")).render(/*#__PURE__*/React.createElement(DifficultyDropdown,{startingDifficulties:startingDifficulties,onChange:()=>socket.send(JSON.stringify({type:"set-difficulties",difficulties:getDropdownValues("difficulties")}))}));