/* globals WebSocket */import account from"../scripts/accounts.js";import questionStats from"../scripts/auth/question-stats.js";import api from"../scripts/api/index.js";import audio from"../audio/index.js";import CategoryManager from"../scripts/utilities/category-manager.js";import{getDropdownValues}from"../scripts/utilities/dropdown-checklist.js";import{arrayToRange,createTossupCard,rangeToArray}from"../scripts/utilities/index.js";import{escapeHTML}from"../scripts/utilities/strings.js";import CategoryModal from"../scripts/components/CategoryModal.min.js";import DifficultyDropdown from"../scripts/components/DifficultyDropdown.min.js";const categoryManager=new CategoryManager;let oldCategories=JSON.stringify(categoryManager.export()),maxPacketNumber=24;/**
 * userId to player object
 */const players={},ROOM_NAME=decodeURIComponent(window.location.pathname.substring(13));let tossup={},USER_ID=window.localStorage.getItem("USER_ID")||"unknown",username=window.localStorage.getItem("multiplayer-username")||(await api.getRandomName());const socket=new WebSocket(window.location.href.replace("http","ws")+(window.location.href.endsWith("?private=true")?"&":"?")+new URLSearchParams({roomName:ROOM_NAME,userId:USER_ID,username}).toString());socket.onmessage=function(a){const b=JSON.parse(a.data);switch(b.type){case"error":socket.close(3e3),window.alert(b.error),window.location.href="/multiplayer";break;case"buzz":socketOnBuzz(b);break;case"change-username":socketOnChangeUsername(b);break;case"force-username":window.alert(b.message),window.localStorage.setItem("multiplayer-username",b.username),document.querySelector("#username").value=b.username;break;case"chat":logChat(b.username,b.message,!1,b.userId);break;case"chat-live-update":logChat(b.username,b.message,!0,b.userId);break;case"clear-stats":socketOnClearStats(b);break;case"connection-acknowledged":socketOnConnectionAcknowledged(b);break;case"connection-acknowledged-query":socketOnConnectionAcknowledgedQuery(b);break;case"connection-acknowledged-tossup":socketOnConnectionAcknowledgedTossup(b);break;case"end-of-set":socketOnEndOfSet(b);break;case"difficulties":0<b.value.length?logEvent(b.username,`changed the difficulties to ${b.value}`):logEvent(b.username,"cleared the difficulties"),updateDifficulties(b.value);break;case"packet-number":b.value=arrayToRange(b.value);// eslint-disable-next-line no-fallthrough
case"set-name":0<b.value.length?logEvent(b.username,`changed the ${b.type} to ${b.value}`):logEvent(b.username,`cleared the ${b.type}`),document.getElementById(b.type).value=b.value;break;case"give-answer":socketOnGiveAnswer(b);break;case"give-answer-live-update":logGiveAnswer(b.username,b.message,!0);break;case"join":socketOnJoin(b);break;case"leave":socketOnLeave(b);break;case"lost-buzzer-race":socketOnLostBuzzerRace(b);break;case"next":case"skip":socketOnNext(b);break;case"no-questions-found":socketOnNoQuestionsFound(b);break;case"pause":socketOnPause(b);break;case"reading-speed":logEvent(b.username,`changed the reading speed to ${b.value}`),document.getElementById("reading-speed").value=b.value,document.getElementById("reading-speed-display").textContent=b.value;break;case"reveal-answer":{document.getElementById("question").innerHTML=b.question,document.getElementById("answer").innerHTML="ANSWER: "+b.answer,document.getElementById("pause").disabled=!0,showNextButton();break}case"start":socketOnStart(b);break;case"timer-update":updateTimerDisplay(b.timeRemaining);break;case"toggle-lock":logEvent(b.username,`${b.lock?"locked":"unlocked"} the room`),document.getElementById("toggle-lock").checked=b.lock;break;case"toggle-powermark-only":logEvent(b.username,`${b.powermarkOnly?"enabled":"disabled"} powermark only`),document.getElementById("toggle-powermark-only").checked=b.powermarkOnly;break;case"toggle-rebuzz":logEvent(b.username,`${b.rebuzz?"enabled":"disabled"} multiple buzzes (effective next question)`),document.getElementById("toggle-rebuzz").checked=b.rebuzz;break;case"toggle-skip":logEvent(b.username,`${b.skip?"enabled":"disabled"} skipping`),document.getElementById("toggle-skip").checked=b.skip,document.getElementById("skip").disabled=!b.skip||document.getElementById("skip").classList.contains("d-none");break;case"toggle-select-by-set-name":b.selectBySetName?(logEvent(b.username,"enabled select by set name"),document.getElementById("toggle-select-by-set-name").checked=!0,document.getElementById("difficulty-settings").classList.add("d-none"),document.getElementById("set-settings").classList.remove("d-none"),document.getElementById("set-name").textContent=b.setName):(logEvent(b.username,"enabled select by difficulty"),document.getElementById("toggle-select-by-set-name").checked=!1,document.getElementById("difficulty-settings").classList.remove("d-none"),document.getElementById("set-settings").classList.add("d-none")),document.getElementById("toggle-powermark-only").disabled=b.selectBySetName,document.getElementById("toggle-standard-only").disabled=b.selectBySetName;break;case"toggle-standard-only":logEvent(b.username,`${b.standardOnly?"enabled":"disabled"} standard format only`),document.getElementById("toggle-standard-only").checked=b.standardOnly;break;case"toggle-timer":logEvent(b.username,`${b.timer?"enabled":"disabled"} the timer`),document.getElementById("toggle-timer").checked=b.timer,document.getElementById("timer").classList.toggle("d-none");break;case"toggle-visibility":logEvent(b.username,`made the room ${b.public?"public":"private"}`),document.getElementById("toggle-visibility").checked=b.public,document.getElementById("chat").disabled=b.public,document.getElementById("toggle-lock").disabled=b.public,document.getElementById("toggle-timer").disabled=b.public,document.getElementById("toggle-timer").checked=!0;break;case"update-categories":logEvent(b.username,"updated the categories"),categoryManager.import(b.categories,b.subcategories,b.alternateSubcategories),categoryManager.loadCategoryModal();break;case"update-question":"(*)"!==b.word&&(document.getElementById("question").innerHTML+=b.word+" ");break;case"year-range":$("#slider").slider("values",0,b.minYear),$("#slider").slider("values",1,b.maxYear),document.getElementById("year-range-a").textContent=b.minYear,document.getElementById("year-range-b").textContent=b.maxYear}},socket.onclose=function(a){const{code:b}=a;clearInterval(PING_INTERVAL_ID),3e3!==b&&window.alert("Disconnected from server")};const socketOnBuzz=a=>{logEvent(a.username,"buzzed"),document.getElementById("buzz").disabled=!0,document.getElementById("pause").disabled=!0,document.getElementById("next").disabled=!0,document.getElementById("skip").disabled=!0,a.userId===USER_ID&&(document.getElementById("answer-input-group").classList.remove("d-none"),document.getElementById("answer-input").focus())},socketOnChangeUsername=a=>{logEvent(a.oldUsername,`changed their username to ${a.newUsername}`),document.getElementById("username-"+a.userId).textContent=a.newUsername,players[a.userId].username=a.newUsername,sortPlayerListGroup(),a.userId===USER_ID&&(username=a.newUsername,window.localStorage.setItem("multiplayer-username",username),document.getElementById("username").value=username)},socketOnClearStats=a=>{for(const b of["celerity","negs","points","powers","tens","tuh","zeroes"])players[a.userId][b]=0;upsertPlayerItem(players[a.userId]),sortPlayerListGroup()},socketOnConnectionAcknowledged=async a=>{switch(USER_ID=a.userId,window.localStorage.setItem("USER_ID",USER_ID),document.getElementById("chat").disabled=a.public,document.getElementById("toggle-rebuzz").checked=a.rebuzz,document.getElementById("toggle-skip").checked=a.skip,document.getElementById("toggle-timer").checked=a.timer,document.getElementById("toggle-timer").disabled=a.public,a.timer||document.getElementById("timer").classList.add("d-none"),document.getElementById("toggle-visibility").checked=a.public,document.getElementById("reading-speed").value=a.readingSpeed,document.getElementById("reading-speed-display").textContent=a.readingSpeed,a.selectBySetName?(document.getElementById("toggle-select-by-set-name").checked=!0,document.getElementById("difficulty-settings").classList.add("d-none"),document.getElementById("set-settings").classList.remove("d-none")):(document.getElementById("toggle-select-by-set-name").checked=!1,document.getElementById("difficulty-settings").classList.remove("d-none"),document.getElementById("set-settings").classList.add("d-none")),a.questionProgress){case 0:document.getElementById("next").textContent="Start",document.getElementById("next").classList.remove("btn-primary"),document.getElementById("next").classList.add("btn-success");break;case 1:showSkipButton(),document.getElementById("options").classList.add("d-none"),a.buzzedIn?(document.getElementById("buzz").disabled=!0,document.getElementById("next").disabled=!0,document.getElementById("pause").disabled=!0):(document.getElementById("buzz").disabled=!1,document.getElementById("pause").disabled=!1);break;case 2:showNextButton(),document.getElementById("options").classList.add("d-none")}a.isPermanent&&(document.getElementById("category-select-button").disabled=!0,document.getElementById("toggle-visibility").disabled=!0,document.getElementById("toggle-select-by-set-name").disabled=!0,document.getElementById("private-chat-warning").innerHTML="This is a permanent room. Some settings have been restricted."),Object.keys(a.players).forEach(b=>{a.players[b].celerity=a.players[b].celerity.correct.average,players[b]=a.players[b],upsertPlayerItem(players[b])}),a.canBuzz||(document.getElementById("buzz").disabled=!0),sortPlayerListGroup()},socketOnConnectionAcknowledgedTossup=a=>{tossup=a.tossup,document.getElementById("set-name-info").textContent=tossup?.set?.name??"",document.getElementById("packet-number-info").textContent=tossup?.packet?.number??"-",document.getElementById("question-number-info").textContent=tossup?.number??"-"},socketOnConnectionAcknowledgedQuery=async a=>{categoryManager.import(a.validCategories,a.validSubcategories,a.validAlternateSubcategories),categoryManager.loadCategoryModal(),updateDifficulties(a.difficulties||[]),document.getElementById("set-name").value=a.setName||"",document.getElementById("packet-number").value=arrayToRange(a.packetNumbers)||"",maxPacketNumber=await api.getNumPackets(document.getElementById("set-name").value),""!==document.getElementById("set-name").value&&0===maxPacketNumber&&document.getElementById("set-name").classList.add("is-invalid"),document.getElementById("toggle-powermark-only").disabled=a.selectBySetName,document.getElementById("toggle-standard-only").disabled=a.selectBySetName,document.getElementById("toggle-powermark-only").checked=a.powermarkOnly,document.getElementById("toggle-standard-only").checked=a.standardOnly,$("#slider").slider("values",0,a.minYear),$("#slider").slider("values",1,a.maxYear),document.getElementById("year-range-a").textContent=a.minYear,document.getElementById("year-range-b").textContent=a.maxYear},socketOnEndOfSet=()=>{window.alert("You have reached the end of the set")},socketOnGiveAnswer=async a=>{document.getElementById("answer-input").value="",document.getElementById("answer-input-group").classList.add("d-none"),document.getElementById("answer-input").blur();const{userId:b,username:c,givenAnswer:d,directive:e,directedPrompt:f,score:g,celerity:h}=a;logGiveAnswer(c,d,!1,e),"prompt"===e&&f?logEvent(c,`was prompted with "${f}"`):"prompt"===e?logEvent(c,"was prompted"):logEvent(c,`${0<g?"":"in"}correctly answered for ${g} points`),"prompt"===e&&b===USER_ID?(document.getElementById("answer-input-group").classList.remove("d-none"),document.getElementById("answer-input").focus(),document.getElementById("answer-input").placeholder=f?`Prompt: "${f}"`:"Prompt"):"prompt"!==e&&(document.getElementById("answer-input").placeholder="Enter answer",document.getElementById("next").disabled=!1,document.getElementById("pause").disabled=!1,"accept"===e&&(document.getElementById("buzz").disabled=!0,Array.from(document.getElementsByClassName("tuh")).forEach(a=>{a.textContent=parseInt(a.innerHTML)+1})),"reject"===e&&(document.getElementById("buzz").disabled=!document.getElementById("toggle-rebuzz").checked&&b===USER_ID),10<g?players[b].powers++:10===g?players[b].tens++:0>g&&players[b].negs++,players[b].points+=g,players[b].tuh++,players[b].celerity=h,upsertPlayerItem(players[b]),sortPlayerListGroup()),"prompt"!==e&&b===USER_ID&&(await account.getUsername())&&questionStats.recordTossup(a.tossup,0<g,g,a.perQuestionCelerity,!0),audio.soundEffects&&b===USER_ID&&("accept"===e&&10<g?audio.power.play():"accept"===e&&10===g?audio.correct.play():"reject"===e&&audio.incorrect.play())},socketOnJoin=a=>{const{userId:b,username:c}=a;logEvent(c,"joined the game");b===USER_ID||(a.isNew?(a.user.celerity=a.user.celerity.correct.average,upsertPlayerItem(a.user),sortPlayerListGroup(),players[b]=a.user):(players[a.userId].isOnline=!0,document.getElementById("points-"+a.userId).classList.add("bg-success"),document.getElementById("points-"+a.userId).classList.remove("bg-secondary")))},socketOnLeave=a=>{logEvent(a.username,"left the game"),players[a.userId].isOnline=!1,document.getElementById("points-"+a.userId).classList.remove("bg-success"),document.getElementById("points-"+a.userId).classList.add("bg-secondary")},socketOnLostBuzzerRace=a=>{logEvent(a.username,"lost the buzzer race"),a.userId===USER_ID&&document.getElementById("answer-input-group").classList.add("d-none")},socketOnNext=a=>{"skip"===a.type?logEvent(a.username,"skipped the question"):logEvent(a.username,"went to the next question"),tossup.question=document.getElementById("question").innerHTML,tossup.answer=document.getElementById("answer").innerHTML.replace("ANSWER: ",""),createTossupCard(tossup),tossup=a.tossup,document.getElementById("set-name-info").textContent=tossup?.set.name??"",document.getElementById("question-number-info").textContent=tossup?.number??"-",document.getElementById("packet-number-info").textContent=tossup?.packet.number??"-",document.getElementById("options").classList.add("d-none"),showSkipButton(),document.getElementById("question").textContent="",document.getElementById("answer").textContent="",document.getElementById("buzz").textContent="Buzz",document.getElementById("buzz").disabled=!1,document.getElementById("pause").textContent="Pause",document.getElementById("pause").disabled=!1,updateTimerDisplay(100)},socketOnNoQuestionsFound=()=>{window.alert("No questions found")},socketOnPause=a=>{logEvent(a.username,`${a.paused?"":"un"}paused the game`)},socketOnStart=a=>{logEvent(a.username,"started the game"),document.getElementById("question").textContent="",document.getElementById("answer").textContent="",document.getElementById("buzz").textContent="Buzz",document.getElementById("buzz").disabled=!1,document.getElementById("pause").textContent="Pause",document.getElementById("pause").disabled=!1,document.getElementById("next").classList.add("btn-primary"),document.getElementById("next").classList.remove("btn-success"),document.getElementById("next").textContent="Next",showSkipButton(),tossup=a.tossup,document.getElementById("set-name-info").textContent=tossup?.set.name??"",document.getElementById("question-number-info").textContent=tossup?.number??"-",document.getElementById("packet-number-info").textContent=tossup?.packet.number??"-"},PING_INTERVAL_ID=setInterval(()=>{socket.send(JSON.stringify({type:"ping"}))},45e3);// Ping server every 45 seconds to prevent socket disconnection
function logChat(a,c,d=!1,e=null){if(!d&&""===c)return void document.getElementById("live-chat-"+e).parentElement.remove();if(!d&&c)return document.getElementById("live-chat-"+e).className="",void(document.getElementById("live-chat-"+e).id="");if(document.getElementById("live-chat-"+e))return void(document.getElementById("live-chat-"+e).textContent=c);const f=document.createElement("b");f.textContent=a;const b=document.createElement("span");b.classList.add("text-muted"),b.id="live-chat-"+e,b.textContent=c;const g=document.createElement("li");g.appendChild(f),g.appendChild(document.createTextNode(" ")),g.appendChild(b),document.getElementById("room-history").prepend(g)}function logEvent(a,b){const c=document.createElement("span");c.textContent=a;const d=document.createElement("span");d.textContent=b;const e=document.createElement("i");e.appendChild(c),e.appendChild(document.createTextNode(" ")),e.appendChild(d);const f=document.createElement("li");f.appendChild(e),document.getElementById("room-history").prepend(f)}function logGiveAnswer(a,c,d=!1,e=null){const f=document.createElement("span");switch(f.textContent="Buzz",e){case"accept":f.className="badge text-dark bg-success";break;case"reject":f.className="badge text-light bg-danger";break;case"prompt":f.className="badge text-dark bg-warning";break;default:f.className="badge text-light bg-primary"}let g=null;("accept"===e||"reject"===e)&&(g=document.createElement("span"),g.className=f.className,"accept"===e?g.textContent="Correct":"reject"===e&&(g.textContent="Incorrect"));const h=document.createElement("b");h.textContent=a;const b=document.createElement("span");b.textContent=c;let i;document.getElementById("live-buzz")?(i=document.getElementById("live-buzz"),i.textContent=""):(i=document.createElement("li"),i.id="live-buzz",document.getElementById("room-history").prepend(i)),i.appendChild(f),i.appendChild(document.createTextNode(" ")),i.appendChild(h),i.appendChild(document.createTextNode(" ")),i.appendChild(b),g&&(i.appendChild(document.createTextNode(" ")),i.appendChild(g)),d||(i.id="")}function showNextButton(){document.getElementById("next").classList.remove("d-none"),document.getElementById("next").disabled=!1,document.getElementById("skip").classList.add("d-none"),document.getElementById("skip").disabled=!0}function showSkipButton(){document.getElementById("skip").classList.remove("d-none"),document.getElementById("skip").disabled=!document.getElementById("toggle-skip").checked,document.getElementById("next").classList.add("d-none"),document.getElementById("next").disabled=!0}function sortPlayerListGroup(c=!0){const d=document.getElementById("player-list-group"),e=Array.from(d.children),f=11;e.sort((d,a)=>{const b=parseInt(document.getElementById("points-"+d.id.substring(f)).innerHTML),e=parseInt(document.getElementById("points-"+a.id.substring(f)).innerHTML);// if points are equal, sort alphabetically by username
if(b===e){const b=document.getElementById("username-"+d.id.substring(f)).innerHTML,e=document.getElementById("username-"+a.id.substring(f)).innerHTML;return c?b.localeCompare(e):e.localeCompare(b)}return c?e-b:b-e}).forEach(a=>{d.appendChild(a)})}function updateDifficulties(a){Array.from(document.getElementById("difficulties").children).forEach(b=>{const c=b.querySelector("input");a.includes(parseInt(c.value))?(c.checked=!0,b.classList.add("active")):(c.checked=!1,b.classList.remove("active"))})}function updateTimerDisplay(a){const b=Math.floor(a/10);document.querySelector(".timer .face").innerText=b,document.querySelector(".timer .fraction").innerText="."+a%10}function upsertPlayerItem(a){const{userId:b,username:c,powers:e=0,tens:f=0,negs:g=0,tuh:h=0,points:i=0,celerity:j=0,isOnline:d}=a;document.getElementById("list-group-"+b)&&document.getElementById("list-group-"+b).remove();const k=document.createElement("a");// bootstrap requires "new" to be called on each popover
// eslint-disable-next-line no-new
k.className=`list-group-item ${b===USER_ID?"user-score":""} clickable`,k.id=`list-group-${b}`,k.innerHTML=`
    <div class="d-flex justify-content-between">
        <span id="username-${b}">${escapeHTML(c)}</span>
        <span><span id="points-${b}" class="badge rounded-pill ${d?"bg-success":"bg-secondary"}">${i}</span></span>
    </div>
    `,k.setAttribute("data-bs-container","body"),k.setAttribute("data-bs-custom-class","w-25"),k.setAttribute("data-bs-html","true"),k.setAttribute("data-bs-placement","left"),k.setAttribute("data-bs-toggle","popover"),k.setAttribute("data-bs-trigger","focus"),k.setAttribute("tabindex","0"),k.setAttribute("data-bs-title",c),k.setAttribute("data-bs-content",`
    <ul class="list-group list-group-flush">
        <li class="list-group-item">
            <span>Powers</span>
            <span id="powers-${b}" class="float-end badge rounded-pill bg-secondary stats-${b}">${e}</span>
        </li>
        <li class="list-group-item">
            <span>Tens</span>
            <span id="tens-${b}" class="float-end badge rounded-pill bg-secondary stats-${b}">${f}</span>
        </li>
        <li class="list-group-item">
            <span>Negs</span>
            <span id="negs-${b}" class="float-end badge rounded-pill bg-secondary stats-${b}">${g}</span>
        </li>
        <li class="list-group-item">
            <span>TUH</span>
            <span id="tuh-${b}" class="float-end badge rounded-pill bg-secondary stats-${b}">${h}</span>
        </li>
        <li class="list-group-item">
            <span>Celerity</span>
            <span id="celerity-${b}" class="float-end stats stats-${b}">${j.toFixed(3)}</span>
        </li>
    </ul>
    `),document.getElementById("player-list-group").appendChild(k),new bootstrap.Popover(k)}document.getElementById("answer-form").addEventListener("submit",function(a){a.preventDefault(),a.stopPropagation();const b=document.getElementById("answer-input").value;socket.send(JSON.stringify({type:"give-answer",givenAnswer:b}))}),document.getElementById("answer-input").addEventListener("input",function(){socket.send(JSON.stringify({type:"give-answer-live-update",message:this.value}))}),document.getElementById("buzz").addEventListener("click",function(){this.blur(),audio.soundEffects&&audio.buzz.play(),socket.send(JSON.stringify({type:"buzz"})),socket.send(JSON.stringify({type:"give-answer-live-update",message:""}))}),document.getElementById("chat").addEventListener("click",function(){this.blur(),document.getElementById("chat-input-group").classList.remove("d-none"),document.getElementById("chat-input").focus(),socket.send(JSON.stringify({type:"chat-live-update",message:""}))}),document.getElementById("chat-form").addEventListener("submit",function(a){a.preventDefault(),a.stopPropagation();const b=document.getElementById("chat-input").value;document.getElementById("chat-input").value="",document.getElementById("chat-input-group").classList.add("d-none"),document.getElementById("chat-input").blur(),socket.send(JSON.stringify({type:"chat",message:b}))}),document.getElementById("chat-input").addEventListener("input",function(){socket.send(JSON.stringify({type:"chat-live-update",message:this.value}))}),document.getElementById("clear-stats").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"clear-stats"}))}),document.getElementById("next").addEventListener("click",function(){switch(this.blur(),this.innerHTML){case"Start":socket.send(JSON.stringify({type:"start"}));break;case"Next":socket.send(JSON.stringify({type:"next"}))}}),document.getElementById("skip").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"skip"}))}),document.getElementById("packet-number").addEventListener("change",function(){const a=rangeToArray(this.value,maxPacketNumber);if(a.some(a=>1>a||a>maxPacketNumber))return document.getElementById("packet-number").classList.add("is-invalid");document.getElementById("packet-number").classList.remove("is-invalid");socket.send(JSON.stringify({type:"packet-number",value:a}))}),document.getElementById("pause").addEventListener("click",function(){this.blur();const a=parseFloat(document.querySelector(".timer .face").innerText),b=parseFloat(document.querySelector(".timer .fraction").innerText);socket.send(JSON.stringify({type:"pause",pausedTime:10*(a+b)}))}),document.getElementById("reading-speed").addEventListener("change",function(){socket.send(JSON.stringify({type:"reading-speed",value:this.value}))}),document.getElementById("reading-speed").addEventListener("input",function(){document.getElementById("reading-speed-display").textContent=this.value}),document.getElementById("report-question-submit").addEventListener("click",function(){api.reportQuestion(document.getElementById("report-question-id").value,document.getElementById("report-question-reason").value,document.getElementById("report-question-description").value)}),document.getElementById("set-name").addEventListener("change",async function(){api.getSetList().includes(this.value)||0===this.value.length?this.classList.remove("is-invalid"):this.classList.add("is-invalid"),maxPacketNumber=await api.getNumPackets(this.value),document.getElementById("packet-number").value=""===this.value||0===maxPacketNumber?"":`1-${maxPacketNumber}`,socket.send(JSON.stringify({type:"set-name",value:this.value,packetNumbers:rangeToArray(document.getElementById("packet-number").value)}))}),document.getElementById("toggle-lock").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-lock",lock:this.checked}))}),document.getElementById("toggle-powermark-only").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-powermark-only",powermarkOnly:this.checked}))}),document.getElementById("toggle-rebuzz").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-rebuzz",rebuzz:this.checked}))}),document.getElementById("toggle-skip").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-skip",skip:this.checked}))}),document.getElementById("toggle-select-by-set-name").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-select-by-set-name",setName:document.getElementById("set-name").value,selectBySetName:this.checked}))}),document.getElementById("toggle-standard-only").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-standard-only",standardOnly:this.checked}))}),document.getElementById("toggle-timer").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-timer",timer:this.checked}))}),document.getElementById("toggle-visibility").addEventListener("click",function(){this.blur(),socket.send(JSON.stringify({type:"toggle-visibility",public:this.checked}))}),document.getElementById("username").addEventListener("change",function(){socket.send(JSON.stringify({type:"change-username",userId:USER_ID,oldUsername:username,username:this.value})),username=this.value,window.localStorage.setItem("multiplayer-username",username)}),document.getElementById("year-range-a").onchange=function(){const[a,b]=$("#slider").slider("values");if(b<a)return void(document.querySelector("#yearRangeAlert").style.display="");document.querySelector("#yearRangeAlert").style.display="none";socket.send(JSON.stringify({type:"year-range",minYear:a,maxYear:b}))},document.addEventListener("keydown",function(a){if("Escape"===a.key&&"chat-input"===document.activeElement.id&&(document.getElementById("chat-input").value="",document.getElementById("chat-input-group").classList.add("d-none"),document.getElementById("chat-input").blur(),socket.send(JSON.stringify({type:"chat",message:""}))),!["INPUT","TEXTAREA","SELECT"].includes(document.activeElement.tagName))switch(a.key){case" ":document.getElementById("buzz").click(),a.target===document.body&&a.preventDefault();break;case"k":document.getElementsByClassName("card-header-clickable")[0].click();break;case"t":document.getElementsByClassName("star-tossup")[0].click();break;case"y":navigator.clipboard.writeText(tossup._id??"");break;case"n":case"s":document.getElementById("next").click(),document.getElementById("skip").click();break;case"p":document.getElementById("pause").click()}}),document.addEventListener("keypress",function(a){"Enter"===a.key&&a.target===document.body&&document.getElementById("chat").click()}),document.getElementById("username").value=username,ReactDOM.createRoot(document.getElementById("category-modal-root")).render(/*#__PURE__*/React.createElement(CategoryModal,{categoryManager:categoryManager,disablePercentView:!0,onClose:()=>{oldCategories!==JSON.stringify(categoryManager.export())&&socket.send(JSON.stringify({type:"update-categories",...categoryManager.export()})),oldCategories=JSON.stringify(categoryManager.export())}})),ReactDOM.createRoot(document.getElementById("difficulty-dropdown-root")).render(/*#__PURE__*/React.createElement(DifficultyDropdown,{onChange:()=>{socket.send(JSON.stringify({type:"difficulties",value:getDropdownValues("difficulties")}))}}));